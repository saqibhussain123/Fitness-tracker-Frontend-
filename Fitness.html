<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fitness Tracker Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        secondary: '#8B5CF6',
                    }
                }
            },
            darkMode: 'class'
        }
    </script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #5D5CDE 0%, #8B5CF6 100%);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .animate-fadeIn {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .btn-primary {
            background: linear-gradient(135deg, #5D5CDE 0%, #8B5CF6 100%);
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(93, 92, 222, 0.3);
        }
        .profile-image {
            object-fit: cover;
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-white min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white dark:bg-gray-800 shadow-lg border-b border-gray-200 dark:border-gray-700">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center">
                        <i class="fas fa-dumbbell text-primary text-2xl mr-2"></i>
                        <span class="text-xl font-bold text-primary">FitTracker Pro</span>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div id="userInfo" class="hidden items-center space-x-2">
                        <img id="userAvatar" class="w-8 h-8 rounded-full profile-image border-2 border-primary" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%235D5CDE'%3E%3Cpath d='M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z'/%3E%3C/svg%3E" alt="Avatar">
                        <span id="userName" class="text-sm font-medium"></span>
                        <button id="logoutBtn" class="text-red-600 hover:text-red-800 text-sm">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Auth Section -->
        <div id="authSection" class="max-w-md mx-auto">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-8 border border-gray-200 dark:border-gray-700">
                <div class="text-center mb-8">
                    <i class="fas fa-dumbbell text-primary text-4xl mb-4"></i>
                    <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Welcome to FitTracker Pro</h2>
                    <p class="text-gray-600 dark:text-gray-400 mt-2">Your personal fitness companion</p>
                </div>

                <!-- Login Form -->
                <div id="loginForm">
                    <h3 class="text-xl font-semibold mb-4">Sign In</h3>
                    <form id="loginFormElement">
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2">Username</label>
                            <input type="text" id="loginUsername" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700" required>
                        </div>
                        <div class="mb-6">
                            <label class="block text-sm font-medium mb-2">Password</label>
                            <input type="password" id="loginPassword" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700" required>
                        </div>
                        <button type="submit" class="w-full btn-primary text-white py-2 px-4 rounded-md font-medium">
                            Sign In
                        </button>
                    </form>
                    <p class="mt-4 text-center text-sm">
                        Don't have an account? 
                        <button id="showRegister" class="text-primary hover:underline">Sign up</button>
                    </p>
                </div>

                <!-- Registration Form -->
                <div id="registerForm" class="hidden">
                    <h3 class="text-xl font-semibold mb-4">Create Account</h3>
                    <form id="registerFormElement">
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2">Profile Image</label>
                            <div class="flex items-center space-x-4">
                                <div class="w-16 h-16 rounded-full overflow-hidden bg-gray-200 dark:bg-gray-700 flex items-center justify-center border-2 border-gray-300 dark:border-gray-600">
                                    <img id="registerImagePreview" class="w-full h-full object-cover hidden" alt="Preview">
                                    <i id="registerImageIcon" class="fas fa-user text-gray-400 text-2xl"></i>
                                </div>
                                <div class="flex-1">
                                    <input type="file" id="registerImage" accept="image/*" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700">
                                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Optional - JPG, PNG or GIF (max 5MB)</p>
                                </div>
                            </div>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2">Full Name</label>
                            <input type="text" id="registerName" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700" required>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2">Email</label>
                            <input type="email" id="registerEmail" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700" required>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2">Username</label>
                            <input type="text" id="registerUsername" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700" required>
                        </div>
                        <div class="mb-6">
                            <label class="block text-sm font-medium mb-2">Password</label>
                            <input type="password" id="registerPassword" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700" required>
                        </div>
                        <button type="submit" class="w-full btn-primary text-white py-2 px-4 rounded-md font-medium">
                            Create Account
                        </button>
                    </form>
                    <p class="mt-4 text-center text-sm">
                        Already have an account? 
                        <button id="showLogin" class="text-primary hover:underline">Sign in</button>
                    </p>
                </div>
            </div>
        </div>

        <!-- Main App Section -->
        <div id="appSection" class="hidden">
            <!-- Navigation Tabs -->
            <div class="mb-8">
                <div class="border-b border-gray-200 dark:border-gray-700">
                    <nav class="-mb-px flex space-x-8">
                        <button class="nav-tab active py-2 px-1 border-b-2 font-medium text-sm" data-tab="dashboard">
                            <i class="fas fa-tachometer-alt mr-2"></i>Dashboard
                        </button>
                        <button class="nav-tab py-2 px-1 border-b-2 font-medium text-sm" data-tab="workouts">
                            <i class="fas fa-dumbbell mr-2"></i>Workouts
                        </button>
                        <button class="nav-tab py-2 px-1 border-b-2 font-medium text-sm" data-tab="nutrition">
                            <i class="fas fa-utensils mr-2"></i>Nutrition
                        </button>
                        <button class="nav-tab py-2 px-1 border-b-2 font-medium text-sm" data-tab="progress">
                            <i class="fas fa-chart-line mr-2"></i>Progress
                        </button>
                        <button class="nav-tab py-2 px-1 border-b-2 font-medium text-sm" data-tab="profile">
                            <i class="fas fa-user mr-2"></i>Profile
                        </button>
                    </nav>
                </div>
            </div>

            <!-- Dashboard Tab -->
            <div id="dashboardTab" class="tab-content">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <!-- Stats Cards -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 border border-gray-200 dark:border-gray-700 card-hover">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-blue-100 dark:bg-blue-900">
                                <i class="fas fa-dumbbell text-blue-600 dark:text-blue-400"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Total Workouts</p>
                                <p id="totalWorkouts" class="text-2xl font-semibold">0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 border border-gray-200 dark:border-gray-700 card-hover">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-green-100 dark:bg-green-900">
                                <i class="fas fa-fire text-green-600 dark:text-green-400"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Calories Today</p>
                                <p id="caloriesTotal" class="text-2xl font-semibold">0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 border border-gray-200 dark:border-gray-700 card-hover">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-purple-100 dark:bg-purple-900">
                                <i class="fas fa-weight text-purple-600 dark:text-purple-400"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Current Weight</p>
                                <p id="currentWeight" class="text-2xl font-semibold">-</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 border border-gray-200 dark:border-gray-700 card-hover">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-orange-100 dark:bg-orange-900">
                                <i class="fas fa-calendar-week text-orange-600 dark:text-orange-400"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600 dark:text-gray-400">Week Streak</p>
                                <p id="weekStreak" class="text-2xl font-semibold">0</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 border border-gray-200 dark:border-gray-700">
                        <h3 class="text-lg font-semibold mb-4">Recent Workouts</h3>
                        <div id="recentWorkouts" class="space-y-3">
                            <p class="text-gray-500 dark:text-gray-400 text-center py-8">No workouts yet. Start your fitness journey!</p>
                        </div>
                    </div>
                    
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 border border-gray-200 dark:border-gray-700">
                        <h3 class="text-lg font-semibold mb-4">Today's Nutrition</h3>
                        <div id="todayNutrition" class="space-y-3">
                            <p class="text-gray-500 dark:text-gray-400 text-center py-8">No meals logged today</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Workouts Tab -->
            <div id="workoutsTab" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">My Workouts</h2>
                    <button id="addWorkoutBtn" class="btn-primary text-white px-4 py-2 rounded-md font-medium">
                        <i class="fas fa-plus mr-2"></i>Add Workout
                    </button>
                </div>

                <div id="workoutsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="text-center py-12 col-span-full">
                        <i class="fas fa-dumbbell text-gray-400 text-4xl mb-4"></i>
                        <p class="text-gray-500 dark:text-gray-400">No workouts yet. Create your first workout routine!</p>
                    </div>
                </div>

                <!-- Add Workout Modal -->
                <div id="workoutModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
                    <div class="bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md mx-4 max-h-screen overflow-y-auto">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-semibold">Add Workout</h3>
                            <button id="closeWorkoutModal" class="text-gray-500 hover:text-gray-700">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <form id="workoutForm">
                            <div class="mb-4">
                                <label class="block text-sm font-medium mb-2">Workout Name</label>
                                <input type="text" id="workoutName" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700" required>
                            </div>
                            <div class="mb-4">
                                <label class="block text-sm font-medium mb-2">Category</label>
                                <select id="workoutCategory" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700">
                                    <option value="strength">Strength Training</option>
                                    <option value="cardio">Cardio</option>
                                    <option value="flexibility">Flexibility</option>
                                    <option value="sports">Sports</option>
                                </select>
                            </div>
                            <div class="mb-4">
                                <label class="block text-sm font-medium mb-2">Duration (minutes)</label>
                                <input type="number" id="workoutDuration" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700" required>
                            </div>
                            <div class="mb-6">
                                <label class="block text-sm font-medium mb-2">Notes</label>
                                <textarea id="workoutNotes" rows="3" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700"></textarea>
                            </div>
                            <div class="flex gap-3">
                                <button type="button" id="cancelWorkout" class="flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700">
                                    Cancel
                                </button>
                                <button type="submit" class="flex-1 btn-primary text-white px-4 py-2 rounded-md font-medium">
                                    Save Workout
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Nutrition Tab -->
            <div id="nutritionTab" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Nutrition Tracking</h2>
                    <button id="addMealBtn" class="btn-primary text-white px-4 py-2 rounded-md font-medium">
                        <i class="fas fa-plus mr-2"></i>Log Meal
                    </button>
                </div>

                <!-- Daily Summary -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6 border border-gray-200 dark:border-gray-700">
                    <h3 class="text-lg font-semibold mb-4">Today's Summary</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="text-center">
                            <p class="text-2xl font-bold text-primary" id="dailyCalories">0</p>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Calories</p>
                        </div>
                        <div class="text-center">
                            <p class="text-2xl font-bold text-green-600" id="dailyProtein">0g</p>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Protein</p>
                        </div>
                        <div class="text-center">
                            <p class="text-2xl font-bold text-blue-600" id="dailyCarbs">0g</p>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Carbs</p>
                        </div>
                        <div class="text-center">
                            <p class="text-2xl font-bold text-yellow-600" id="dailyFats">0g</p>
                            <p class="text-sm text-gray-600 dark:text-gray-400">Fats</p>
                        </div>
                    </div>
                </div>

                <!-- Meals List -->
                <div id="mealsList" class="space-y-4">
                    <div class="text-center py-12">
                        <i class="fas fa-utensils text-gray-400 text-4xl mb-4"></i>
                        <p class="text-gray-500 dark:text-gray-400">No meals logged today. Start tracking your nutrition!</p>
                    </div>
                </div>

                <!-- Add Meal Modal -->
                <div id="mealModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
                    <div class="bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md mx-4 max-h-screen overflow-y-auto">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-semibold">Log Meal</h3>
                            <button id="closeMealModal" class="text-gray-500 hover:text-gray-700">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <form id="mealForm">
                            <div class="mb-4">
                                <label class="block text-sm font-medium mb-2">Meal Type</label>
                                <select id="mealType" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700">
                                    <option value="breakfast">Breakfast</option>
                                    <option value="lunch">Lunch</option>
                                    <option value="dinner">Dinner</option>
                                    <option value="snack">Snack</option>
                                </select>
                            </div>
                            <div class="mb-4">
                                <label class="block text-sm font-medium mb-2">Food Item</label>
                                <input type="text" id="foodItem" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700" required>
                            </div>
                            <div class="mb-4">
                                <label class="block text-sm font-medium mb-2">Quantity</label>
                                <input type="text" id="foodQuantity" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700" placeholder="e.g., 1 cup, 100g" required>
                            </div>
                            <div class="grid grid-cols-2 gap-3 mb-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Calories</label>
                                    <input type="number" id="foodCalories" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Protein (g)</label>
                                    <input type="number" step="0.1" id="foodProtein" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700">
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-3 mb-6">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Carbs (g)</label>
                                    <input type="number" step="0.1" id="foodCarbs" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Fats (g)</label>
                                    <input type="number" step="0.1" id="foodFats" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700">
                                </div>
                            </div>
                            <div class="flex gap-3">
                                <button type="button" id="cancelMeal" class="flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700">
                                    Cancel
                                </button>
                                <button type="submit" class="flex-1 btn-primary text-white px-4 py-2 rounded-md font-medium">
                                    Log Meal
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Progress Tab -->
            <div id="progressTab" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Progress Tracking</h2>
                    <button id="addProgressBtn" class="btn-primary text-white px-4 py-2 rounded-md font-medium">
                        <i class="fas fa-plus mr-2"></i>Add Entry
                    </button>
                </div>

                <!-- Progress Charts -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 border border-gray-200 dark:border-gray-700">
                        <h3 class="text-lg font-semibold mb-4">Weight Progress</h3>
                        <canvas id="weightChart" width="400" height="200"></canvas>
                    </div>
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 border border-gray-200 dark:border-gray-700">
                        <h3 class="text-lg font-semibold mb-4">Workout Frequency</h3>
                        <canvas id="workoutChart" width="400" height="200"></canvas>
                    </div>
                </div>

                <!-- Progress Entries -->
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 border border-gray-200 dark:border-gray-700">
                    <h3 class="text-lg font-semibold mb-4">Progress Entries</h3>
                    <div id="progressEntries" class="space-y-3">
                        <p class="text-gray-500 dark:text-gray-400 text-center py-8">No progress entries yet. Start tracking your journey!</p>
                    </div>
                </div>

                <!-- Add Progress Modal -->
                <div id="progressModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
                    <div class="bg-white dark:bg-gray-800 rounded-lg p-6 w-full max-w-md mx-4 max-h-screen overflow-y-auto">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-semibold">Add Progress Entry</h3>
                            <button id="closeProgressModal" class="text-gray-500 hover:text-gray-700">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <form id="progressForm">
                            <div class="mb-4">
                                <label class="block text-sm font-medium mb-2">Date</label>
                                <input type="date" id="progressDate" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700" required>
                            </div>
                            <div class="mb-4">
                                <label class="block text-sm font-medium mb-2">Weight (kg)</label>
                                <input type="number" step="0.1" id="progressWeight" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700">
                            </div>
                            <div class="mb-4">
                                <label class="block text-sm font-medium mb-2">Body Fat (%)</label>
                                <input type="number" step="0.1" id="progressBodyFat" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700">
                            </div>
                            <div class="mb-6">
                                <label class="block text-sm font-medium mb-2">Notes</label>
                                <textarea id="progressNotes" rows="3" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700"></textarea>
                            </div>
                            <div class="flex gap-3">
                                <button type="button" id="cancelProgress" class="flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700">
                                    Cancel
                                </button>
                                <button type="submit" class="flex-1 btn-primary text-white px-4 py-2 rounded-md font-medium">
                                    Save Entry
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Profile Tab -->
            <div id="profileTab" class="tab-content hidden">
                <div class="max-w-2xl mx-auto">
                    <h2 class="text-2xl font-bold mb-6">Profile Settings</h2>
                    
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 border border-gray-200 dark:border-gray-700">
                        <form id="profileForm">
                            <div class="flex items-center mb-6">
                                <div class="relative">
                                    <img id="profileAvatar" class="w-20 h-20 rounded-full profile-image border-2 border-primary" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%235D5CDE'%3E%3Cpath d='M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z'/%3E%3C/svg%3E" alt="Profile">
                                    <button type="button" id="changeProfileImage" class="absolute bottom-0 right-0 bg-primary text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-secondary transition-colors">
                                        <i class="fas fa-camera"></i>
                                    </button>
                                    <input type="file" id="profileImageInput" accept="image/*" class="hidden">
                                </div>
                                <div class="ml-4">
                                    <h3 class="text-lg font-semibold" id="profileDisplayName">User Name</h3>
                                    <p class="text-gray-600 dark:text-gray-400" id="profileDisplayEmail">user@example.com</p>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Full Name</label>
                                    <input type="text" id="profileName" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Email</label>
                                    <input type="email" id="profileEmail" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700">
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Age</label>
                                    <input type="number" id="profileAge" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Height (cm)</label>
                                    <input type="number" id="profileHeight" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Goal Weight (kg)</label>
                                    <input type="number" step="0.1" id="profileGoalWeight" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700">
                                </div>
                            </div>
                            
                            <div class="mb-6">
                                <label class="block text-sm font-medium mb-2">Fitness Goal</label>
                                <select id="profileGoal" class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-primary bg-white dark:bg-gray-700">
                                    <option value="lose_weight">Lose Weight</option>
                                    <option value="gain_weight">Gain Weight</option>
                                    <option value="maintain">Maintain Weight</option>
                                    <option value="build_muscle">Build Muscle</option>
                                    <option value="improve_fitness">Improve Fitness</option>
                                </select>
                            </div>
                            
                            <button type="submit" class="btn-primary text-white px-6 py-2 rounded-md font-medium">
                                Save Profile
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Dark mode support
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // App state management
        class FitnessApp {
            constructor() {
                this.currentUser = null;
                this.users = [];
                this.workouts = [];
                this.meals = [];
                this.progressEntries = [];
                this.currentTab = 'dashboard';
                
                this.init();
            }

            init() {
                this.bindEvents();
                this.updateUI();
                
                // Set default date for progress form
                document.getElementById('progressDate').valueAsDate = new Date();
            }

            bindEvents() {
                // Auth events
                document.getElementById('loginFormElement').addEventListener('submit', (e) => this.handleLogin(e));
                document.getElementById('registerFormElement').addEventListener('submit', (e) => this.handleRegister(e));
                document.getElementById('showRegister').addEventListener('click', () => this.showRegisterForm());
                document.getElementById('showLogin').addEventListener('click', () => this.showLoginForm());
                document.getElementById('logoutBtn').addEventListener('click', () => this.handleLogout());

                // Profile image upload events
                document.getElementById('registerImage').addEventListener('change', (e) => this.handleImagePreview(e, 'register'));
                document.getElementById('changeProfileImage').addEventListener('click', () => {
                    document.getElementById('profileImageInput').click();
                });
                document.getElementById('profileImageInput').addEventListener('change', (e) => this.handleProfileImageChange(e));

                // Tab navigation
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    tab.addEventListener('click', (e) => this.switchTab(e.target.dataset.tab));
                });

                // Workout events
                document.getElementById('addWorkoutBtn').addEventListener('click', () => this.showWorkoutModal());
                document.getElementById('closeWorkoutModal').addEventListener('click', () => this.hideWorkoutModal());
                document.getElementById('cancelWorkout').addEventListener('click', () => this.hideWorkoutModal());
                document.getElementById('workoutForm').addEventListener('submit', (e) => this.handleAddWorkout(e));

                // Meal events
                document.getElementById('addMealBtn').addEventListener('click', () => this.showMealModal());
                document.getElementById('closeMealModal').addEventListener('click', () => this.hideMealModal());
                document.getElementById('cancelMeal').addEventListener('click', () => this.hideMealModal());
                document.getElementById('mealForm').addEventListener('submit', (e) => this.handleAddMeal(e));

                // Progress events
                document.getElementById('addProgressBtn').addEventListener('click', () => this.showProgressModal());
                document.getElementById('closeProgressModal').addEventListener('click', () => this.hideProgressModal());
                document.getElementById('cancelProgress').addEventListener('click', () => this.hideProgressModal());
                document.getElementById('progressForm').addEventListener('submit', (e) => this.handleAddProgress(e));

                // Profile events
                document.getElementById('profileForm').addEventListener('submit', (e) => this.handleUpdateProfile(e));
            }

            handleImagePreview(event, context) {
                const file = event.target.files[0];
                if (file) {
                    // Check file size (5MB limit)
                    if (file.size > 5 * 1024 * 1024) {
                        alert('Image size must be less than 5MB');
                        event.target.value = '';
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = (e) => {
                        if (context === 'register') {
                            const preview = document.getElementById('registerImagePreview');
                            const icon = document.getElementById('registerImageIcon');
                            preview.src = e.target.result;
                            preview.classList.remove('hidden');
                            icon.classList.add('hidden');
                        }
                    };
                    reader.readAsDataURL(file);
                }
            }

            handleProfileImageChange(event) {
                const file = event.target.files[0];
                if (file) {
                    // Check file size (5MB limit)
                    if (file.size > 5 * 1024 * 1024) {
                        alert('Image size must be less than 5MB');
                        event.target.value = '';
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const imageData = e.target.result;
                        // Update current user's profile image
                        this.currentUser.profileImage = imageData;
                        
                        // Update all profile image displays
                        document.getElementById('userAvatar').src = imageData;
                        document.getElementById('profileAvatar').src = imageData;
                    };
                    reader.readAsDataURL(file);
                }
            }

            showRegisterForm() {
                document.getElementById('loginForm').classList.add('hidden');
                document.getElementById('registerForm').classList.remove('hidden');
                // Reset image preview
                document.getElementById('registerImagePreview').classList.add('hidden');
                document.getElementById('registerImageIcon').classList.remove('hidden');
            }

            showLoginForm() {
                document.getElementById('registerForm').classList.add('hidden');
                document.getElementById('loginForm').classList.remove('hidden');
            }

            handleLogin(e) {
                e.preventDefault();
                const username = document.getElementById('loginUsername').value;
                const password = document.getElementById('loginPassword').value;

                const user = this.users.find(u => u.username === username && u.password === password);
                if (user) {
                    this.currentUser = user;
                    this.updateUI();
                    this.switchTab('dashboard');
                } else {
                    alert('Invalid credentials');
                }
            }

            handleRegister(e) {
                e.preventDefault();
                const name = document.getElementById('registerName').value;
                const email = document.getElementById('registerEmail').value;
                const username = document.getElementById('registerUsername').value;
                const password = document.getElementById('registerPassword').value;
                const imageFile = document.getElementById('registerImage').files[0];

                if (this.users.find(u => u.username === username)) {
                    alert('Username already exists');
                    return;
                }

                const user = {
                    id: Date.now(),
                    name,
                    email,
                    username,
                    password,
                    age: '',
                    height: '',
                    goalWeight: '',
                    goal: 'maintain',
                    profileImage: null
                };

                // Handle profile image if uploaded
                if (imageFile) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        user.profileImage = e.target.result;
                        this.users.push(user);
                        this.currentUser = user;
                        this.updateUI();
                        this.switchTab('dashboard');
                    };
                    reader.readAsDataURL(imageFile);
                } else {
                    this.users.push(user);
                    this.currentUser = user;
                    this.updateUI();
                    this.switchTab('dashboard');
                }
            }

            handleLogout() {
                this.currentUser = null;
                this.updateUI();
            }

            updateUI() {
                const authSection = document.getElementById('authSection');
                const appSection = document.getElementById('appSection');
                const userInfo = document.getElementById('userInfo');

                if (this.currentUser) {
                    authSection.classList.add('hidden');
                    appSection.classList.remove('hidden');
                    userInfo.classList.remove('hidden');
                    userInfo.classList.add('flex');
                    
                    document.getElementById('userName').textContent = this.currentUser.name;
                    
                    // Update profile images
                    const defaultImage = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%235D5CDE'%3E%3Cpath d='M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z'/%3E%3C/svg%3E";
                    const userImage = this.currentUser.profileImage || defaultImage;
                    
                    document.getElementById('userAvatar').src = userImage;
                    document.getElementById('profileAvatar').src = userImage;
                    
                    this.updateDashboard();
                    this.updateProfile();
                } else {
                    authSection.classList.remove('hidden');
                    appSection.classList.add('hidden');
                    userInfo.classList.add('hidden');
                }
            }

            switchTab(tabName) {
                this.currentTab = tabName;
                
                // Update tab buttons
                document.querySelectorAll('.nav-tab').forEach(tab => {
                    if (tab.dataset.tab === tabName) {
                        tab.classList.add('active', 'border-primary', 'text-primary');
                        tab.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700');
                    } else {
                        tab.classList.remove('active', 'border-primary', 'text-primary');
                        tab.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700');
                    }
                });

                // Update tab content
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.add('hidden');
                });
                document.getElementById(tabName + 'Tab').classList.remove('hidden');

                // Initialize tab-specific content
                if (tabName === 'progress') {
                    this.initCharts();
                } else if (tabName === 'workouts') {
                    this.updateWorkoutsList();
                } else if (tabName === 'nutrition') {
                    this.updateNutritionSummary();
                    this.updateMealsList();
                }
            }

            updateDashboard() {
                const userWorkouts = this.workouts.filter(w => w.userId === this.currentUser.id);
                const userMeals = this.meals.filter(m => m.userId === this.currentUser.id);
                const userProgress = this.progressEntries.filter(p => p.userId === this.currentUser.id);

                // Update stats
                document.getElementById('totalWorkouts').textContent = userWorkouts.length;
                
                const todayMeals = userMeals.filter(m => this.isToday(new Date(m.date)));
                const todayCalories = todayMeals.reduce((sum, meal) => sum + meal.calories, 0);
                document.getElementById('caloriesTotal').textContent = todayCalories;

                const latestWeight = userProgress.length > 0 ? 
                    userProgress.sort((a, b) => new Date(b.date) - new Date(a.date))[0].weight : null;
                document.getElementById('currentWeight').textContent = latestWeight ? `${latestWeight} kg` : '-';

                // Calculate week streak (simplified)
                document.getElementById('weekStreak').textContent = Math.min(userWorkouts.length, 7);

                // Update recent workouts
                this.updateRecentWorkouts(userWorkouts);
                this.updateTodayNutrition(todayMeals);
            }

            updateRecentWorkouts(workouts) {
                const container = document.getElementById('recentWorkouts');
                const recent = workouts.slice(-3).reverse();
                
                if (recent.length === 0) {
                    container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8">No workouts yet. Start your fitness journey!</p>';
                    return;
                }

                container.innerHTML = recent.map(workout => `
                    <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                        <div>
                            <p class="font-medium">${workout.name}</p>
                            <p class="text-sm text-gray-600 dark:text-gray-400">${workout.category}  ${workout.duration} min</p>
                        </div>
                        <span class="text-xs text-gray-500">${this.formatDate(workout.date)}</span>
                    </div>
                `).join('');
            }

            updateTodayNutrition(meals) {
                const container = document.getElementById('todayNutrition');
                
                if (meals.length === 0) {
                    container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8">No meals logged today</p>';
                    return;
                }

                container.innerHTML = meals.map(meal => `
                    <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                        <div>
                            <p class="font-medium">${meal.foodItem}</p>
                            <p class="text-sm text-gray-600 dark:text-gray-400">${meal.type}  ${meal.quantity}</p>
                        </div>
                        <span class="text-sm font-medium">${meal.calories} cal</span>
                    </div>
                `).join('');
            }

            showWorkoutModal() {
                document.getElementById('workoutModal').classList.remove('hidden');
                document.getElementById('workoutModal').classList.add('flex');
            }

            hideWorkoutModal() {
                document.getElementById('workoutModal').classList.add('hidden');
                document.getElementById('workoutModal').classList.remove('flex');
                document.getElementById('workoutForm').reset();
            }

            handleAddWorkout(e) {
                e.preventDefault();
                const workout = {
                    id: Date.now(),
                    userId: this.currentUser.id,
                    name: document.getElementById('workoutName').value,
                    category: document.getElementById('workoutCategory').value,
                    duration: parseInt(document.getElementById('workoutDuration').value),
                    notes: document.getElementById('workoutNotes').value,
                    date: new Date()
                };

                this.workouts.push(workout);
                this.hideWorkoutModal();
                this.updateWorkoutsList();
                this.updateDashboard();
            }

            updateWorkoutsList() {
                const container = document.getElementById('workoutsList');
                const userWorkouts = this.workouts.filter(w => w.userId === this.currentUser.id);

                if (userWorkouts.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-12 col-span-full">
                            <i class="fas fa-dumbbell text-gray-400 text-4xl mb-4"></i>
                            <p class="text-gray-500 dark:text-gray-400">No workouts yet. Create your first workout routine!</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = userWorkouts.map(workout => `
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 border border-gray-200 dark:border-gray-700 card-hover">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="text-lg font-semibold">${workout.name}</h3>
                            <button onclick="app.deleteWorkout(${workout.id})" class="text-red-500 hover:text-red-700">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        <div class="space-y-2">
                            <p class="text-sm text-gray-600 dark:text-gray-400">
                                <i class="fas fa-tag mr-2"></i>${workout.category}
                            </p>
                            <p class="text-sm text-gray-600 dark:text-gray-400">
                                <i class="fas fa-clock mr-2"></i>${workout.duration} minutes
                            </p>
                            <p class="text-sm text-gray-600 dark:text-gray-400">
                                <i class="fas fa-calendar mr-2"></i>${this.formatDate(workout.date)}
                            </p>
                            ${workout.notes ? `<p class="text-sm text-gray-600 dark:text-gray-400 mt-3">${workout.notes}</p>` : ''}
                        </div>
                    </div>
                `).join('');
            }

            deleteWorkout(id) {
                this.workouts = this.workouts.filter(w => w.id !== id);
                this.updateWorkoutsList();
                this.updateDashboard();
            }

            showMealModal() {
                document.getElementById('mealModal').classList.remove('hidden');
                document.getElementById('mealModal').classList.add('flex');
            }

            hideMealModal() {
                document.getElementById('mealModal').classList.add('hidden');
                document.getElementById('mealModal').classList.remove('flex');
                document.getElementById('mealForm').reset();
            }

            handleAddMeal(e) {
                e.preventDefault();
                const meal = {
                    id: Date.now(),
                    userId: this.currentUser.id,
                    type: document.getElementById('mealType').value,
                    foodItem: document.getElementById('foodItem').value,
                    quantity: document.getElementById('foodQuantity').value,
                    calories: parseInt(document.getElementById('foodCalories').value),
                    protein: parseFloat(document.getElementById('foodProtein').value) || 0,
                    carbs: parseFloat(document.getElementById('foodCarbs').value) || 0,
                    fats: parseFloat(document.getElementById('foodFats').value) || 0,
                    date: new Date()
                };

                this.meals.push(meal);
                this.hideMealModal();
                this.updateNutritionSummary();
                this.updateMealsList();
                this.updateDashboard();
            }

            updateNutritionSummary() {
                const todayMeals = this.meals.filter(m => 
                    m.userId === this.currentUser.id && this.isToday(new Date(m.date))
                );

                const totals = todayMeals.reduce((sum, meal) => ({
                    calories: sum.calories + meal.calories,
                    protein: sum.protein + meal.protein,
                    carbs: sum.carbs + meal.carbs,
                    fats: sum.fats + meal.fats
                }), { calories: 0, protein: 0, carbs: 0, fats: 0 });

                document.getElementById('dailyCalories').textContent = totals.calories;
                document.getElementById('dailyProtein').textContent = `${totals.protein.toFixed(1)}g`;
                document.getElementById('dailyCarbs').textContent = `${totals.carbs.toFixed(1)}g`;
                document.getElementById('dailyFats').textContent = `${totals.fats.toFixed(1)}g`;
            }

            updateMealsList() {
                const container = document.getElementById('mealsList');
                const todayMeals = this.meals.filter(m => 
                    m.userId === this.currentUser.id && this.isToday(new Date(m.date))
                );

                if (todayMeals.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-12">
                            <i class="fas fa-utensils text-gray-400 text-4xl mb-4"></i>
                            <p class="text-gray-500 dark:text-gray-400">No meals logged today. Start tracking your nutrition!</p>
                        </div>
                    `;
                    return;
                }

                const mealsByType = todayMeals.reduce((groups, meal) => {
                    if (!groups[meal.type]) groups[meal.type] = [];
                    groups[meal.type].push(meal);
                    return groups;
                }, {});

                container.innerHTML = Object.entries(mealsByType).map(([type, meals]) => `
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 border border-gray-200 dark:border-gray-700">
                        <h3 class="text-lg font-semibold mb-4 capitalize">${type}</h3>
                        <div class="space-y-3">
                            ${meals.map(meal => `
                                <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
                                    <div>
                                        <p class="font-medium">${meal.foodItem}</p>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">${meal.quantity}</p>
                                        <p class="text-xs text-gray-500 dark:text-gray-400">
                                            P: ${meal.protein}g | C: ${meal.carbs}g | F: ${meal.fats}g
                                        </p>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-medium">${meal.calories} cal</p>
                                        <button onclick="app.deleteMeal(${meal.id})" class="text-red-500 hover:text-red-700 text-sm">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `).join('');
            }

            deleteMeal(id) {
                this.meals = this.meals.filter(m => m.id !== id);
                this.updateNutritionSummary();
                this.updateMealsList();
                this.updateDashboard();
            }

            showProgressModal() {
                document.getElementById('progressModal').classList.remove('hidden');
                document.getElementById('progressModal').classList.add('flex');
            }

            hideProgressModal() {
                document.getElementById('progressModal').classList.add('hidden');
                document.getElementById('progressModal').classList.remove('flex');
                document.getElementById('progressForm').reset();
                document.getElementById('progressDate').valueAsDate = new Date();
            }

            handleAddProgress(e) {
                e.preventDefault();
                const progress = {
                    id: Date.now(),
                    userId: this.currentUser.id,
                    date: new Date(document.getElementById('progressDate').value),
                    weight: parseFloat(document.getElementById('progressWeight').value) || null,
                    bodyFat: parseFloat(document.getElementById('progressBodyFat').value) || null,
                    notes: document.getElementById('progressNotes').value
                };

                this.progressEntries.push(progress);
                this.hideProgressModal();
                this.updateProgressEntries();
                this.initCharts();
                this.updateDashboard();
            }

            updateProgressEntries() {
                const container = document.getElementById('progressEntries');
                const userProgress = this.progressEntries
                    .filter(p => p.userId === this.currentUser.id)
                    .sort((a, b) => new Date(b.date) - new Date(a.date));

                if (userProgress.length === 0) {
                    container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8">No progress entries yet. Start tracking your journey!</p>';
                    return;
                }

                container.innerHTML = userProgress.map(entry => `
                    <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                        <div>
                            <p class="font-medium">${this.formatDate(entry.date)}</p>
                            <div class="text-sm text-gray-600 dark:text-gray-400 space-x-4">
                                ${entry.weight ? `<span>Weight: ${entry.weight} kg</span>` : ''}
                                ${entry.bodyFat ? `<span>Body Fat: ${entry.bodyFat}%</span>` : ''}
                            </div>
                            ${entry.notes ? `<p class="text-sm text-gray-600 dark:text-gray-400 mt-1">${entry.notes}</p>` : ''}
                        </div>
                        <button onclick="app.deleteProgress(${entry.id})" class="text-red-500 hover:text-red-700">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `).join('');
            }

            deleteProgress(id) {
                this.progressEntries = this.progressEntries.filter(p => p.id !== id);
                this.updateProgressEntries();
                this.initCharts();
                this.updateDashboard();
            }

            initCharts() {
                if (!this.currentUser) return;

                const userProgress = this.progressEntries
                    .filter(p => p.userId === this.currentUser.id)
                    .sort((a, b) => new Date(a.date) - new Date(b.date));

                const userWorkouts = this.workouts
                    .filter(w => w.userId === this.currentUser.id)
                    .sort((a, b) => new Date(a.date) - new Date(b.date));

                this.initWeightChart(userProgress);
                this.initWorkoutChart(userWorkouts);
            }

            initWeightChart(progressData) {
                const ctx = document.getElementById('weightChart').getContext('2d');
                
                // Destroy existing chart if it exists
                if (this.weightChart) {
                    this.weightChart.destroy();
                }

                const weightData = progressData.filter(p => p.weight).map(p => ({
                    x: p.date,
                    y: p.weight
                }));

                this.weightChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        datasets: [{
                            label: 'Weight (kg)',
                            data: weightData,
                            borderColor: '#5D5CDE',
                            backgroundColor: 'rgba(93, 92, 222, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: {
                                type: 'time',
                                time: {
                                    unit: 'day'
                                }
                            },
                            y: {
                                beginAtZero: false
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
            }

            initWorkoutChart(workoutData) {
                const ctx = document.getElementById('workoutChart').getContext('2d');
                
                // Destroy existing chart if it exists
                if (this.workoutChart) {
                    this.workoutChart.destroy();
                }

                // Group workouts by week
                const weeklyData = {};
                workoutData.forEach(workout => {
                    const weekStart = this.getWeekStart(new Date(workout.date));
                    const weekKey = weekStart.toISOString().split('T')[0];
                    weeklyData[weekKey] = (weeklyData[weekKey] || 0) + 1;
                });

                const chartData = Object.entries(weeklyData).map(([week, count]) => ({
                    x: week,
                    y: count
                }));

                this.workoutChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        datasets: [{
                            label: 'Workouts per Week',
                            data: chartData,
                            backgroundColor: '#8B5CF6',
                            borderColor: '#8B5CF6',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: {
                                type: 'time',
                                time: {
                                    unit: 'week'
                                }
                            },
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 1
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
            }

            updateProfile() {
                if (!this.currentUser) return;

                document.getElementById('profileDisplayName').textContent = this.currentUser.name;
                document.getElementById('profileDisplayEmail').textContent = this.currentUser.email;
                document.getElementById('profileName').value = this.currentUser.name;
                document.getElementById('profileEmail').value = this.currentUser.email;
                document.getElementById('profileAge').value = this.currentUser.age || '';
                document.getElementById('profileHeight').value = this.currentUser.height || '';
                document.getElementById('profileGoalWeight').value = this.currentUser.goalWeight || '';
                document.getElementById('profileGoal').value = this.currentUser.goal || 'maintain';
            }

            handleUpdateProfile(e) {
                e.preventDefault();
                
                this.currentUser.name = document.getElementById('profileName').value;
                this.currentUser.email = document.getElementById('profileEmail').value;
                this.currentUser.age = document.getElementById('profileAge').value;
                this.currentUser.height = document.getElementById('profileHeight').value;
                this.currentUser.goalWeight = document.getElementById('profileGoalWeight').value;
                this.currentUser.goal = document.getElementById('profileGoal').value;

                // Update display
                document.getElementById('profileDisplayName').textContent = this.currentUser.name;
                document.getElementById('profileDisplayEmail').textContent = this.currentUser.email;
                document.getElementById('userName').textContent = this.currentUser.name;

                alert('Profile updated successfully!');
            }

            // Utility functions
            isToday(date) {
                const today = new Date();
                return date.toDateString() === today.toDateString();
            }

            formatDate(date) {
                return new Date(date).toLocaleDateString();
            }

            getWeekStart(date) {
                const d = new Date(date);
                const day = d.getDay();
                const diff = d.getDate() - day;
                return new Date(d.setDate(diff));
            }
        }

        // Initialize the app
        const app = new FitnessApp();

        // Add some demo data for testing
        app.users.push({
            id: 1,
            name: 'Demo User',
            email: 'demo@example.com',
            username: 'demo',
            password: 'demo',
            age: 25,
            height: 175,
            goalWeight: 70,
            goal: 'maintain',
            profileImage: null
        });
    </script>
</body>
</html>